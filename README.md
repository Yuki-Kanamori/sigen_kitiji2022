# R4（2020）年度キチジ太平洋北部の資源評価
## 必要なデータセット; abchan2に提出済
#### （●は昨年のデータをそのまま使い回すもの，○は昨年のデータに修正が必要なものを表す）    
####  R2の『引き継ぎ資料2 (chap2.R) 』部分のデータセット
○ ALdata.xlsx: 年齢査定したデータ．パートさんからもらったファイルに年齢査定結果を手入力  
○ survey_N_at_length: 前年10月のトロール調査で得られた体長別資源尾数（mdbより．魚種別体長別資源量のNS別のデータ．q_魚種別体長別資源量2021.xlsx）  
○ okisoko_after2019.xlsx: 2019年以降の沖底データ（mdbより）    
● okisoko_old.csv: 2018年までの沖底データ（mdbより）    
○ catch_pref.xlsx: 県からもらった漁獲量データ．古いフォーマット（.xls）を読み込めるコードにはしていないので，名前をつけて保存でxlsxにする  
● catchdata_old.csv: 2018年までの県からもらった漁獲量データをcsvにしたもの  
● effortdata_old.csv: 2018年までの県からもらった努力量データをcsvにしたもの  
● olddata_trawl.csv: 2018年までのトロール調査で得られた年齢別漁獲量と年齢別漁獲尾数，および（沖底）漁獲量をまとめたもの（過去のエクセルより）  
○ trawl_N_at_length_ns.csv: 2019年までのトロール調査で得られた南北別体長別資源尾数（mdbより）        　　
○ rawdata_fig5_for_nextSA.csv: 漁獲量の時系列データ（昨年度の資源評価より）  

#### R2の『引き継ぎ資料3 (chap3.R) 』部分のデータセット
●Map.txt: 調査域の緯度経度情報（由来不明）  
●キアンコウ緯度経度.txt: 海区の緯度経度（由来不明）  
○catch_miyagi.csv: 宮城県からもらった2021年の漁獲物データ．catch_pref.csvを作成したデータの別シート    
○taityo_miyagi_fresco.csv: 宮城県からもらった2021年の漁獲物の体長データ（その1）．フレスコから落とす  
○yatyo_miyagi.csv: 宮城県からもらった2021年の漁獲物の体長データ（その2）．県からもらった箱入れキチジ体長.xlsxをcsv化  
○hati_sokutei.csv: 青森県からもらった2021年の漁獲物の体長データ．漁獲量データと同じだけど，銘柄を修正する必要がある  
○hati_sokutei2019.csv: 青森県からもらった2019年の漁獲物の体長データ．規格名と規格コードのデータフレームを作成するためだけに使用　　
○taityo_FRA.csv: 八戸庁舎で精密測定した2021年の体長データ（sokouoより）  
○trawl_ns_length2.csv: 2021年のトロール調査で得られた南北別体長別資源尾数詳細（mdbより）  
○lonlat2021.csv: 2021年のトロール調査点の緯度経度情報（mdbより）  
●marmap_coord.csv: 等深線の情報（由来不明）  

---
## Rmarkdownの構成
### 1. {r prefecture}
県からもらった漁獲量の処理    
!!県の漁獲量を資源量計算に使用するため，資源量計算の前に処理する必要がある!!        
    
- step1. 県から提出された漁獲量データ（沖底以外）を集計する    
!!県から提出されたデータの構造に合わせてコードの修正が必要!!    
県が提出する「沖底」の漁獲量 ≠ 沖底漁績の値，なので，step2で修正する    
            
        
- step2. 漁獲量データを集計する    
-- step2-0. 昨年度の図5のデータ&最新版の沖底漁績データの読み込み    
-- step2-1. 沖底漁績の確定値をstep.2-0に入れる    
-- step2-2. 沖底漁績の暫定値をstep.1の県データに入れる    
            県が提出する「沖底」の漁獲量 ≠ 沖底漁績の値，に注意    
-- step2-3. 図5に必要なデータの統合    
-- step2-4. 表1のデータを作成    
     
- step3. 作図    


### 2. {r get biomass}
資源量の計算   
- step1. Number at ageデータの作成
-- step1-1. Age-Length Keyの作成
-- step1-2. von Bertalanffy growth curveの推定
-- step1-3. 年齢別体長別の尾数データの算出（これは資源評価結果ではない）
-- step1-4. 年齢別の平均体長と平均重量を算出
    
- step2. 年齢別の生存率を算出
     
- step3. 体長別の採集効率(q)を考える
        
- step4. 体長から体重を算出
            
- step5. 採集効率が年齢で変わることを考慮して10月（調査時）の資源量と資源尾数を算出
            
- step6. 1月時点での資源量を算出するため，調査が行われた10月以降の2ヶ月分の漁獲率や自然死亡率などを仮定する
            
- step7. 10月の調査データから1月の資源量を算出
        
- step8. 漁獲割合
            
- step9. 作図; figs. 10-12



### 3. {r get srr}
再生産関係の計算


### 4. {r ABC}
ABCの計算


### 5. {r fig9}
青森県と宮城県における漁獲物の体長組成の作成


### 6. {r okisoko}
沖底漁績データの集計


### 7. {r figA3-4}
補足図3-4の作成


### 8. {r fig4}
図4の作成


### 9. {r figsA3}
補足図3の作成


### 10. {r save}
ディレクトリの下にoutputsフォルダを作成し，資源評価表に必要な図表を出す

---
## Rmarkdownでよく出る不具合
tidyverseを使う部分で不具合が出ることが多い．原因不明なので，name spaceを入れたり別の関数を使ったりして，個別のマシンで動くように書き換える．なお，主担当者のPC環境では問題なく結果が出ることを確認済み  
例）  
・mutate()を使って新しい列を入れる: $使って書き換える  
・group_by()とsummarize(): name spaceを入れる  
